<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://getbootstrap.com/docs/5.2/assets/css/docs.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <title>Simple Sidebar - Login</title>

  <style>
    .jb-red {
      color: red;
    }
    .olmessagef {color: red; font-style: Italic;}
    .olmessaget {color: blue; font-style: Italic;}

  </style>
</head>
<body class="align-middle" >
<div class="container-fluid d-flex justify-content-center" style="height: 100vh">


  <div class="card align-self-center">
    <div class="card-header">
      Login Page
    </div>
    <div class="card-body">
      <th:block th:if="${param.logout != null}">
        <h3>logout</h3>
      </th:block>

      <form id="registerForm" action="/login" method="post">
        <input type="hidden" name="_csrf" value="{{_csrf.token}}"/>
        <div class="input-group mb-3">
          <span class="input-group-text">아이디</span>
          <input type="text" name="username" class="form-control" placeholder="USER ID" >
        </div>
        <div class="input-group mb-3">
          <span class="input-group-text">패스워드</span>
          <input type="password" name="password" class="form-control" placeholder="PASSWORD">



        </div>
        <div class="input-group mb-3 ">
          <input class="form-check-input" type="checkbox" name="remember-me">
          <label class="form-check-label">
            자동 로그인
          </label>
        </div>
        <span th:if="${error}">
            <p id="valid" class="alert alert-danger" th:text="${exception}"></p>
        </span>


        <div class="my-4">
          <div class="float-end">
            <button type="submit" class="btn btn-primary submitBtn">LOGIN</button>
            <button type="button" class="btn btn-primary submitBtn" onclick="location.href='/signUp'">회원가입</button>
            <button type="button" class="btn btn-primary submitBtn" onclick="location.href='/'">홈으로</button>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">아이디 찾기 </button>
<!--            <button type="button" class="btn btn-primary submitBtn" id="findfind">&lt;!&ndash;onclick="location.href='/Findid_password'"&ndash;&gt;아이디 찾기</button>-->
            <button type="button" class="btn btn-primary submitBtn" id="findfind2">비밀번호 찾기</button>


          </div>
        </div>
      </form>
    </div><!--end card body-->
  </div><!--end card-->
</div>


<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" data-bs-backdrop="static" aria-labelledby="exampleModal2" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">아이디 찾기</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="u_mail" class="fw-semibold" >회원가입시 작성했던 메일을 입력해주세요 :</label>
            <input type="email"class="form-control" id="u_mail" placeholder="Email을 입력해주세요.">
          </div>
          <div class="mb-3">
            <label for="u_tel" class="fw-semibold" >회원가입시 작성했던 전화번호를 입력해주세요 :</label>
            <input type="text"class="form-control" id="u_tel" placeholder="전화번호를 입력해주세요.">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <input type="submit" class="btn btn-primary" id="ffid" value="아이디찾기" >
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="nono" tabindex="-2" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabe3">아이디없음!</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        해당하는 아이디가 없습니다!
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="exampleModal2" tabindex="-1" data-bs-backdrop="static" aria-labelledby="exampleModal2" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel2">비밀번호 찾기</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="u_mail" class="fw-semibold" >회원가입시 작성했던 메일을 입력해주세요 :</label>
            <input type="email"class="form-control" id="umail" placeholder="Email을 입력해주세요.">
          </div>
          <div class="mb-3">
            <label for="u_tel" class="fw-semibold" >회원가입시 작성했던 이름을 입력해주세요 :</label>
            <input type="text"class="form-control" id="uname" placeholder="이름을 입력해주세요.">
          </div>
          <span id ="olmessage"></span>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="checkButton">등록여부확인</button>
        <input type="submit" class="btn btn-primary" id="ffid2" value="비밀번호찾기"disabled="disabled" >
      </div>
    </div>
  </div>
</div>



<div class="modal fade" id="yesyes" tabindex="-2" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabe5">메일발송완료!</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        해당하는 메일로 새로운 비밀번호가 전송되었습니다! 확인해주세요!
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>

//아이디 찾기 시작
  $("#findfind").on("click",function () {
    $('#exampleModal').modal('show');

  })

  $('#ffid').on("click",function () {
    let u_mail = $('#u_mail').val();
    let u_tel = $('#u_tel').val();
    console.log(u_tel, u_mail);
    if (u_mail === "") {
      alert("메일을 입력해주세요.");
    } else if (u_tel === "") {
      alert("전화번호를 입력해주세요.");
    } else {
      $.ajax({
        type: "get",
        async: false,
        url: "/FIndid",
        data: {u_mail: u_mail, u_tel: u_tel},
        success: function (data) {
          if (data === "") {
            $("#nono").modal("show");
          } else {
            var html = "";
            html = "            <label for=\"u_tel\" class=\"fw-semibold\" >아이디를 찾았어요! : " + data + "</label>\n"

            $("#ffid").remove();
            $("#exampleModal .modal-body").html(html);
            $("#exampleModal").modal("show");
          }
        }
      })
    }
  })
// 아이디 찾기 끝

  // <!-- 비밀번호 찾기 시작!-->
  $("#findfind2").on("click",function () {
    $('#exampleModal2').modal('show');
  })

  $("#checkButton").click(function () {
    const u_mail = $("#umail").val();
    const u_name = $("#uname").val();
    $.ajax({
      type: "get",
      async: false,
      url: "/mailcheck",
      data: {u_mail: u_mail, u_name: u_name},
      success: function (data) {
        console.log("데이타" + data);
        if (data == 0) {
          $("#olmessage").text("일치하는 메일이 없습니다.");
          $("#olmessage").addClass("olmessagef");
          $("#olmessage").removeClass("olmessaget");
        } else {
          $("#olmessage").text("등록된 이메일이 존재합니다.");
          $("#olmessage").addClass("olmessaget");
          $("#olmessage").removeClass("olmessagef");
          $("#ffid2").attr("disabled", false);
        }
      }
    })
  })

$("#ffid2").on("click",function () {
  const u_mail = $("#umail").val();
  const u_name = $("#uname").val();
  $.ajax({
    type: 'post',
    url: '/sendEmail',
    data: {'memberEmail': u_mail, 'u_name': u_name},
    dataType: "text",
    success: function (result) {
     $('#yesyes').modal("show");
      $('#yesyes').on('hidden.bs.modal', function () {
        location.href="/login"
      })
    }

  })
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

</body>
</html>
